<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8">
  <title>Ù„Ø¹Ø¨Ø© Ø¬Ù…Ø¹ Ø§Ù„Ø¹Ù…Ù„Ø§Øª</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Ù„ÙˆÙ† Ø´Ø±ÙŠØ· Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙÙŠ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ -->
  <meta name="theme-color" content="#111111">

  <!-- Ø±Ø¨Ø· Ù…Ù„Ù Ø§Ù„Ù€ manifest -->
  <link rel="manifest" href="manifest.json">

  <!-- Ø£ÙŠÙ‚ÙˆÙ†Ø© Ø¹Ø§Ø¯ÙŠØ© Ù„Ù„Ù…ØªØµÙØ­ -->
  <link rel="icon" href="icon-192.png">

  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      background: #222;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      font-family: sans-serif;
      color: #fff;
    }

    #gameContainer {
      position: relative;
      width: 360px;
      height: 640px;
      border: 2px solid #555;
      background: #111;
      overflow: hidden;
      touch-action: none;
    }

    canvas {
      display: block;
      width: 100%;
      height: 100%;
      background: #222;
    }

    #info {
      position: absolute;
      top: 8px;
      left: 8px;
      font-size: 14px;
      z-index: 2;
      text-shadow: 0 0 4px #000;
    }

    #message {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 16px;
      text-align: center;
      text-shadow: 0 0 4px #000;
      transition: opacity 0.3s ease;
    }

    /* Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚Ø¨Ø¶ (Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø±) */
    #sliderArea {
      position: absolute;
      bottom: 10px;
      left: 10px;
      right: 10px;
      height: 40px;
      border-radius: 20px;
      background: #333;
      border: 1px solid #555;
      z-index: 3;
      touch-action: none;
    }

    #handle {
      position: absolute;
      top: 3px;
      left: 50%;
      transform: translateX(-50%);
      width: 60px;
      height: 34px;
      border-radius: 17px;
      background: #4caf50;
      box-shadow: 0 0 8px rgba(0,0,0,0.5);
      text-align: center;
      line-height: 34px;
      font-size: 12px;
      user-select: none;
    }
  </style>
</head>
<body>
  <div id="gameContainer">
    <div id="info">Ø§Ù„Ù†Ù‚Ø§Ø·: <span id="score">0</span></div>
    <div id="message">Ø­Ø±Ù‘Ùƒ Ø§Ù„Ù…Ù‚Ø¨Ø¶ Ø§Ù„Ø£Ø®Ø¶Ø± Ù„ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨</div>
    <canvas id="game" width="360" height="640"></canvas>

    <!-- Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ù…Ù‚Ø¨Ø¶ -->
    <div id="sliderArea">
      <div id="handle">ØªØ­Ø±ÙŠÙƒ</div>
    </div>
  </div>

  <script>
    // Ø¹Ù†Ø§ØµØ± HTML
    const canvas = document.getElementById('game');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const messageEl = document.getElementById('message');
    const sliderArea = document.getElementById('sliderArea');
    const handle = document.getElementById('handle');

    const W = canvas.width;
    const H = canvas.height;

    // Ø§Ù„Ù„Ø§Ø¹Ø¨
    const player = {
      w: 50,
      h: 50,
      x: W / 2 - 25,
      y: H - 80,
      speed: 5
    };

    // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
    const coins = [];
    let score = 0;
    let frameCount = 0;

    // Ù„Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
    let moveDir = 0;

    // Ù„Ø±Ø³Ø§Ù„Ø© "Ø´Ø§Ø·Ø± ÙŠØ§ Ù…Ø­Ù…Ø¯"
    let messageTimeout = null;

    function showCongrats() {
      messageEl.textContent = `Ø´Ø§Ø·Ø± ÙŠØ§ Ù…Ø­Ù…Ø¯! Ø¬Ù…Ø¹Øª ${score} Ø¹Ù…Ù„Ø© ðŸŽ‰`;
      messageEl.style.opacity = '1';

      if (messageTimeout) clearTimeout(messageTimeout);
      messageTimeout = setTimeout(() => {
        messageEl.style.opacity = '0';
      }, 2000);
    }

    // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø©
    function spawnCoin() {
      const size = 20;
      const x = Math.random() * (W - size);
      coins.push({
        x: x,
        y: -size,
        r: size / 2,
        speed: 3 + Math.random() * 2
      });
    }

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†Ø·Ù‚
    function update() {
      frameCount++;

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)
      if (moveDir !== 0) {
        player.x += moveDir * player.speed;
      }

      // Ø­Ø¯ÙˆØ¯ Ø§Ù„Ø´Ø§Ø´Ø©
      if (player.x < 0) player.x = 0;
      if (player.x + player.w > W) player.x = W - player.w;

      // Ø¹Ù…Ù„Ø© Ø¬Ø¯ÙŠØ¯Ø© ÙƒÙ„ Ø«Ø§Ù†ÙŠØ© ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹
      if (frameCount % 60 === 0) {
        spawnCoin();
      }

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ø¹Ù…Ù„Ø§Øª + Ø§Ù„ØªØµØ§Ø¯Ù…
      for (let i = coins.length - 1; i >= 0; i--) {
        const c = coins[i];
        c.y += c.speed;

        // ØªØµØ§Ø¯Ù… Ù…Ø¹ Ø§Ù„Ù„Ø§Ø¹Ø¨
        if (
          c.y + c.r > player.y &&
          c.y - c.r < player.y + player.h &&
          c.x + c.r > player.x &&
          c.x - c.r < player.x + player.w
        ) {
          coins.splice(i, 1);
          score++;
          scoreEl.textContent = score;

          // ÙƒÙ„ 100 ÙƒÙˆÙŠÙ† â†’ Ø±Ø³Ø§Ù„Ø© ØªØ´Ø¬ÙŠØ¹
          if (score > 0 && score % 100 === 0) {
            showCongrats();
          }

          continue;
        }

        // Ø®Ø±ÙˆØ¬ Ù…Ù† Ø§Ù„Ø´Ø§Ø´Ø©
        if (c.y - c.r > H) {
          coins.splice(i, 1);
        }
      }
    }

    // Ø§Ù„Ø±Ø³Ù…
    function draw() {
      ctx.fillStyle = '#111';
      ctx.fillRect(0, 0, W, H);

      // Ø§Ù„Ù„Ø§Ø¹Ø¨
      ctx.fillStyle = '#4caf50';
      ctx.fillRect(player.x, player.y, player.w, player.h);

      // Ø§Ù„Ø¹Ù…Ù„Ø§Øª
      ctx.fillStyle = '#ffd700';
      for (const c of coins) {
        ctx.beginPath();
        ctx.arc(c.x, c.y, c.r, 0, Math.PI * 2);
        ctx.fill();
      }
    }

    // Ø­Ù„Ù‚Ø© Ø§Ù„Ù„Ø¹Ø¨Ø©
    function loop() {
      update();
      draw();
      requestAnimationFrame(loop);
    }

    // ØªØ­ÙƒÙ… Ø¨Ø§Ù„ÙƒÙŠØ¨ÙˆØ±Ø¯ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
    window.addEventListener('keydown', (e) => {
      if (e.key === 'ArrowLeft') moveDir = -1;
      if (e.key === 'ArrowRight') moveDir = 1;
    });

    window.addEventListener('keyup', (e) => {
      if ((e.key === 'ArrowLeft' && moveDir === -1) ||
          (e.key === 'ArrowRight' && moveDir === 1)) {
        moveDir = 0;
      }
    });

    // ===== Ø§Ù„ØªØ­ÙƒÙ… Ø¨Ø§Ù„Ù…Ù‚Ø¨Ø¶ (Ø³Ù„Ø§ÙŠØ¯Ø±) =====
    let isDragging = false;

    function updateFromSlider(clientX) {
      const rect = sliderArea.getBoundingClientRect();
      // Ù†Ø³Ø¨Ø© Ø§Ù„Ù…ÙƒØ§Ù† Ø¯Ø§Ø®Ù„ Ø§Ù„Ø³Ù„Ø§ÙŠØ¯Ø± Ø¨ÙŠÙ† 0 Ùˆ 1
      let ratio = (clientX - rect.left) / rect.width;
      if (ratio < 0) ratio = 0;
      if (ratio > 1) ratio = 1;

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù…Ù‚Ø¨Ø¶
      const handleWidth = handle.offsetWidth;
      const handleX = ratio * (rect.width - handleWidth);
      handle.style.left = handleX + 'px';

      // ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ Ø¹Ù„Ù‰ Ø­Ø³Ø¨ Ø§Ù„Ù†Ø³Ø¨Ø©
      player.x = ratio * (W - player.w);
    }

    // Ù„Ù…Ø³
    sliderArea.addEventListener('touchstart', (e) => {
      isDragging = true;
      const touch = e.touches[0];
      if (!touch) return;
      updateFromSlider(touch.clientX);
      e.preventDefault();
    }, { passive: false });

    sliderArea.addEventListener('touchmove', (e) => {
      if (!isDragging) return;
      const touch = e.touches[0];
      if (!touch) return;
      updateFromSlider(touch.clientX);
      e.preventDefault();
    }, { passive: false });

    sliderArea.addEventListener('touchend', () => {
      isDragging = false;
    });

    sliderArea.addEventListener('touchcancel', () => {
      isDragging = false;
    });

    // Ù…Ø§ÙˆØ³ (Ù„Ù„ØªØ¬Ø±Ø¨Ø© Ø¹Ù„Ù‰ Ø§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ±)
    sliderArea.addEventListener('mousedown', (e) => {
      isDragging = true;
      updateFromSlider(e.clientX);
    });

    window.addEventListener('mousemove', (e) => {
      if (!isDragging) return;
      updateFromSlider(e.clientX);
    });

    window.addEventListener('mouseup', () => {
      isDragging = false;
    });

    // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ù€ Service Worker Ø¹Ø´Ø§Ù† PWA
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js')
          .catch(err => {
            console.log('Service Worker registration failed:', err);
          });
      });
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„Ù„Ø¹Ø¨Ø©
    loop();
  </script>
</body>
</html>